{% extends '../subpages_base.html' %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% block title %}
    <title>Create Post | DIY CONNECT</title>
    {% endblock title%}
  </head>
  <style>
    /* {% block styles %} */
    .sty-inp-postAdd-image {
      height: 560px;
      width: 560px;
      border: solid 2px;

      display: flex;
      justify-content: center; /* Center horizontally */
      align-items: center; /* Center vertically */
      text-align: center; /* Ensure text is centered */
      margin: auto; /* Centers the whole circle in the parent container */
      font-size: 30px;

      font-family: "Montserrat", sans-serif;

      font-weight: 800;
      font-style: normal;
    }

    .sty-inp-IN-image {
      display: grid;
      height: 560px;
      width: 560px;
      gap: 5px;
      background: #f0f0f0;
      overflow: hidden;
    }
    .sty-btn-post-component {
      width: 170px;
      height: 45px;
      color: #283618;
      background-color: #fefae0;
    }
    .sty-inp-txt-header {
      height: 170px;
      text-align: center;
      background-color: #d9d9d9;
      border: #283618 2px solid;
      color: black;
      overflow: auto;
      resize: none;
    }
    .sty-header-weight {
      font-weight: 800;
    }
    .sty-inp-txt-subheader {
      background-color: #d9d9d9;
      border: #283618 2px solid;
      color: black;
      font-weight: 400;
      resize: none;
    }
    .sty-subheader-lbl {
      color: black;
      font-weight: 700;
    }
    .sty-role {
      width: 100%;
      font-weight: 500;
      border: #ffffff solid 1px;
    }
    .sty-role-selected {
      background-color: #d9d9d9;
      color: #283618;
    }
    .sty-role-not-selected {
      background-color: #283618;
      color: #fefae0;
    }
    .sty-role-not-selected:hover {
      cursor: pointer;
    }
    .sty-icon-info {
      color: #75f94c;
      font-size: 40px;
    }
    .sty-description-lbl {
      text-align: justify;
      color: black;
    }
    .sty-err-msg {
      color: red;
      font-size: 20px;
      font-weight: 500;
    }
    @media (max-width: 768px) {
      .sty-header-big-font-size {
        font-size: 30px !important;
      }
      .sty-subtitle-low-font-size-mobile {
        font-size: 13px !important;
        padding-bottom: 2rem;
        padding-top: 2rem;
      }
      #desc_onchange {
        font-size: 10px;
      }
      .sty-inp-IN-image {
        height: 330px !important;
        width: 90vw !important;
      }
      .sty-inp-postAdd-image {
        height: 330px !important;
        width: 90vw !important;
      }
    }
    /* {% endblock styles %} */
  </style>
  <body>
    <!-- prettier-ignore -->
    {% block content %}
    <!-- //prettier-ignore -->
    <div class="container">
      <div class="columns is-vcentered has-text-centered">
        <div class="column">
          <div>
            <!--
            <input
              type="text "
              placeholder="Add A Title"
              class="input sty-header-big-font-size sty-inp-txt-header sty-header-weight"
              id="inp_title"
            />
            -->
            <textarea
              placeholder="Add A Title"
              name=""
              id="inp_title"
              class="input sty-header-big-font-size sty-inp-txt-header sty-header-weight"
            ></textarea>
          </div>
          <div>
            <textarea
              class="textarea sty-inp-txt-subheader mt-2 sty-font-family-hind"
              placeholder="Add a description"
              id="inp_desc"
            ></textarea>
          </div>
          <div class="">
            <h1
              class="has-text-left sty-subtitle-low-font-size sty-font-family-roboto mt-5 sty-subheader-lbl"
            >
              Pick role you stated...
            </h1>
          </div>
          <div class="columns is-0 is-mobile">
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role sty-subtitle-low-font-size-mobile"
                onclick="role_post_desc()"
              >
                Contributor
              </h1>
            </div>
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role sty-subtitle-low-font-size-mobile"
                onclick="role_post_desc()"
              >
                Innovator
              </h1>
            </div>
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role sty-subtitle-low-font-size-mobile"
                onclick="role_post_desc()"
              >
                Collector
              </h1>
            </div>
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role sty-subtitle-low-font-size-mobile"
                onclick="role_post_desc()"
              >
                Showcase
              </h1>
            </div>
          </div>
          <!-- Hidden Role-->
          <input type="text" id="inp_role" hidden />
          <div class="columns is-vcentered is-mobile">
            <div class="column is-2">
              <h1 class="sty-icon-info">
                <ion-icon name="information-circle"></ion-icon>
              </h1>
            </div>
            <div class="column">
              <h1
                id="desc_onchange"
                class="sty-subtitle-lower-font-size sty-font-family-hind sty-description-lbl"
              >
                description
              </h1>
            </div>
          </div>
        </div>
        <div class="column">
          <div
            class="sty-inp-postAdd-image sty-inp-IN-image"
            id="btn_inp_image"
          >
            <!-- CSS ISSUE -->
            <h1>
              <ion-icon name="add-circle" style="font-size: 195px"></ion-icon>
            </h1>
            <!-- HIDDEN INPUT FILE -->
            <input
              type="file"
              src=""
              name=""
              id="inp_image"
              accept="image/*"
              hidden
              multiple
            />
          </div>
        </div>
      </div>
      <div class="has-text-centered sty-err-msg" id="err_msg"></div>
    </div>
    <!-- prettier-ignore -->
    <div id="get_link" data-url="{% url 'main:diyconn_home' %}" hidden></div>
    {% endblock content %}
    <!-- //prettier-ignore -->
  </body>

  <script>
    //{% block scripts %}

    // INITIALIZED
    let ini_inp_role = document.getElementById("inp_role");
    let ini_desc_onchange = document.getElementById("desc_onchange");
    ini_inp_role.value = "Contributor";
    ini_desc_onchange.innerHTML =
      "A Contributor is an individual who provides materials, resources, or support to a project, organization, or business. <b> As a contributor, you are encouraged to share items that can be repurposed, ensuring they are useful to others. Please only post items that you are willing to give away freely for the benefit of those who can make use of them. </b>";
    let ini_sty_choice_role = document.querySelectorAll("#sty_choice_role");
    ini_sty_choice_role.forEach((el) =>
      el.classList.add("sty-role-not-selected")
    );
    ini_sty_choice_role[0].classList.remove("sty-role-not-selected");
    ini_sty_choice_role[0].classList.add("sty-role-selected");
    // GIVEN
    let usr_all_bck_opt_label = document.querySelectorAll(
      "#usr_all_bck_opt_label"
    );

    let usr_all_bck_opt_ref = document.querySelectorAll("#usr_all_bck_opt_ref");
    let get_link = document.getElementById("get_link");

    usr_all_bck_opt_label.forEach((element) => {
      element.textContent = "Create Post";
    });
    usr_all_bck_opt_ref.forEach((element) => {
      element.href = get_link.getAttribute("data-url");
    });

    let usr_all_end_opt = document.querySelectorAll("#usr_all_end_opt");

    let err_msg = document.getElementById("err_msg");

    //let selectedFile_compiled = null;
    // INTIALIZE THE COMPONENT
    usr_all_end_opt.forEach((element) => {
      let btn_create = document.createElement("div");
      btn_create.classList.add("button");
      btn_create.classList.add("sty-subtitle-low-font-size");
      btn_create.classList.add("sty-font-family-roboto");
      btn_create.classList.add("sty-btn-post-component");

      btn_create.textContent = "POST";
      element.appendChild(btn_create);
    });

    let inp_image = document.getElementById("inp_image");
    let btn_inp_image = document.getElementById("btn_inp_image");
    btn_inp_image.addEventListener("click", () => {
      inp_image.click();
    });
    let selectedFiles = null;
    inp_image.addEventListener("change", (event) => {
      //let selectedFile_compiled = event.target.files;
      selectedFiles = Array.from(event.target.files); // Convert FileList to Array
      let count = selectedFiles.length;

      if (count === 1) {
        btn_inp_image.style.gridTemplateColumns = "1fr";
        btn_inp_image.style.gridTemplateRows = "1fr";
      } else if (count === 2) {
        btn_inp_image.style.gridTemplateColumns = "1fr 1fr";
        btn_inp_image.style.gridTemplateRows = "1fr";
      } else if (count === 3) {
        btn_inp_image.style.gridTemplateColumns = "1fr 1fr";
        btn_inp_image.style.gridTemplateRows = "1fr 1fr";
      } else if (count == 4) {
        btn_inp_image.style.gridTemplateColumns = "1fr 1fr";
        btn_inp_image.style.gridTemplateRows = "1fr 1fr";
      } else {
        err_msg.textContent = "Can only take 4 images per post";
        //alert("Can only take 4 images per post");
        return;
      }

      // Clear previous images (optional)
      btn_inp_image.innerHTML = "";
      btn_inp_image.style.display = "grid";

      // Define layout based on image count

      // Add images dynamically
      selectedFiles.forEach((file, index) => {
        let imageUrl = URL.createObjectURL(file);
        let img = document.createElement("img");
        img.src = imageUrl;
        img.style.width = "100%";
        img.style.height = "100%";
        img.style.objectFit = "cover";

        // If 3 images, make the last one span two columns
        if (count === 3 && index === 2) {
          img.style.gridColumn = "1 / span 2";
        }

        btn_inp_image.appendChild(img);
      });

      // Hide text inside the div (if exists)
      let textElement = btn_inp_image.querySelector("h1");
      if (textElement) textElement.style.display = "none";
    });

    //Given
    let desc_onchange = document.getElementById("desc_onchange");
    function role_post_desc() {
      let sty_choice_role = document.querySelectorAll("#sty_choice_role");
      sty_choice_role.forEach((el) =>
        el.classList.add("sty-role-not-selected")
      );
      let inp_role = document.getElementById("inp_role");
      let role_desc = event.target.textContent.replace(/\s+/g, "");

      if (role_desc === "Contributor") {
        desc_onchange.innerHTML =
          "A Contributor is an individual who provides materials, resources, or support to a project, organization, or business. <b> As a contributor, you are encouraged to share items that can be repurposed, ensuring they are useful to others. Please only post items that you are willing to give away freely for the benefit of those who can make use of them. </b>";
        inp_role.value = "Contributor";
      } else if (role_desc === "Innovator") {
        desc_onchange.innerHTML =
          "An Innovator is an  individual who  collects and creatively repurposes items to give them a second life through innovative projects. <b> As an innovator, you should only post projects that you genuinely intend to create</b>, demonstrating how the collected items can be transformed into something new and valuable. By doing so, you contribute to a more sustainable and environmentally friendly community.";
        inp_role.value = "Innovator";
      } else if (role_desc === "Collector") {
        desc_onchange.innerHTML =
          "A Collector is an individual who gathers recyclable items that can be exchanged for money or other benefits. If you are a collector, you should only <b> post items that you are actively looking to collect and are willing to pick up or receive.</b> This helps facilitate an efficient exchange process while promoting recycling and sustainability.";
        inp_role.value = "Collector";
      } else if (role_desc == "Showcase") {
        desc_onchange.innerHTML =
          "If you are posting in the Showcase section, make sure to only share completed works or creative uses of materials, not items you are giving away or requesting.<b> This helps foster a culture of innovation, motivates others to act sustainably, and builds a shared gallery of eco-friendly inspiration.</b>";
        inp_role.value = "Showcase";
      }

      event.target.classList.remove("sty-role-not-selected");
      event.target.classList.add("sty-role-selected");
    }

    function Validate() {
      //Given
      if (!selectedFiles) {
        console.log("there is no files");
        err_msg.textContent = "Please add a input in all fields";
        //err_msg.textContent = "Please add a profile image";
        return false;
      }

      let inp_role = document.getElementById("inp_role").value;
      let inp_title = document.getElementById("inp_title").value;
      let inp_desc = document.getElementById("inp_desc").value;
      if (inp_role === "" || inp_title === "" || inp_desc === "") {
        err_msg.textContent = "Please add a input in all fields";

        return false;
      }
      let data = new FormData();
      data.append("role", inp_role);
      data.append("title", inp_title);
      data.append("description", inp_desc);
      selectedFiles.forEach((file, index) => {
        data.append(`imagesFiles[${index}]`, file);
      });
      return data;
    }
    usr_all_end_opt.forEach((element) => {
      element.addEventListener("click", () => {
        let form_data = Validate();
        //console.log(form_data);
        if (!form_data) {
          return;
        }
        // console.log([...form_data.entries()]); // Debug: Log form data content
        //let filler_data = {};
        //POST
        let response = fetch("{% url 'main:postAdd' %}", {
          method: "POST",
          headers: {
            "X-CSRFToken": getCookie("csrftoken"),
          },
          mode: "same-origin",
          body: form_data,
        })
          .then((res) => {
            return res.json();
          })
          .then((msg) => {
            console.log(msg);
            window.location.href = `/${msg.redirect_url}`;
          })
          .catch((err) => {
            console.log(err);
          });
      });
    });
    /*
    usr_all_end_opt.addEventListener("click", () => {
      let form_data = Validate();
      //console.log(form_data);
      if (!form_data) {
        return;
      }
      // console.log([...form_data.entries()]); // Debug: Log form data content
      //let filler_data = {};
      //POST
      let response = fetch("{% url 'main:postAdd' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": getCookie("csrftoken"),
        },
        mode: "same-origin",
        body: form_data,
      })
        .then((res) => {
          return res.json();
        })
        .then((msg) => {
          console.log(msg);
          window.location.href = `/${msg.redirect_url}`;
        })
        .catch((err) => {
          console.log(err);
        });
    });
  */

    //{% endblock scripts %}
  </script>
</html>
