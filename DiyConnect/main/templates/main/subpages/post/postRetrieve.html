{% extends '../subpages_base.html' %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% block title %}
    <title>Retrieve Post | DIY CONNECT</title>
    {% endblock title %}

    <style>
      /*{% block styles %}*/
      .sty-role-not-selected:hover {
        cursor: default !important;
      }
      .sty-role-not-selected {
        color: #283618 !important;
      }
      .sty-sect-cl-opt {
        background-color: #283618;
      }
      .sty-sect-opt-icon {
        font-size: 38px;
        color: #ffffff;
      }
      .sty-sect-opt {
        font-size: 40px;
        color: #ffffff;
        border: solid #ffffff 1px;
      }
      /*{% endblock styles %}*/
    </style>
  </head>
  <body>
    <!-- prettier-ignore -->
    {% block content %}
    <!-- //prettier-ignore -->
    {% if not post_data %}
    <h1>There is no file</h1>
    {% else %}

    <div class="container">
      <div class="columns is-vcentered has-text-centered">
        <div class="column">
          <div>
            <!--
            <input
              type="text "
              placeholder="Add A Title"
              class="input sty-header-big-font-size sty-inp-txt-header sty-header-weight"
              id="inp_title"
            />
            -->

            <!-- prettier-ignore -->
            <textarea readonly
              placeholder="Add A Title"
              name=""
              id="inp_title"
              class="input sty-header-big-font-size sty-inp-txt-header sty-header-weight"
            >
{{ post_data.title}}</textarea
            >
            <!-- //prettier-ignore -->
          </div>
          <div>
            <!-- prettier-ignore -->
            <textarea readonly
              class="textarea sty-inp-txt-subheader mt-2 sty-font-family-hind"
              placeholder="Add a description"
              id="inp_desc"
            >
 {{ post_data.description }}</textarea
            >
            <!-- //prettier-ignore -->
          </div>

          <div class="columns mt-5 is-vcentered sty-sect-cl-opt">
            <div class="column">
              <h1 class="px-6 sty-sect-opt-icon">
                <ion-icon name="chatbox-ellipses"></ion-icon>
              </h1>
            </div>
            <div class="column sty-sect-opt px-6">
              <h1 class="">Request</h1>
            </div>
            <div class="column">
              <h1
                class="px-6 sty-sect-opt-icon"
                data-url="/post/specific/{{ post_data.ID }}"
                onclick="copyLinkPost(event)"
              >
                <ion-icon name="share-outline"></ion-icon>
              </h1>
            </div>
          </div>
          <div class="">
            <h1
              class="has-text-left sty-subtitle-low-font-size sty-font-family-roboto mt-5 sty-subheader-lbl"
            >
              Role Post: {{ post_data.user_role_type }}
            </h1>
          </div>
          <!-- Removing part template: Checking 
          <div class="columns is-0" style="visibility: hidden">
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role"
                onclick="role_post_desc()"
              >
                Contributor
              </h1>
            </div>
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role"
                onclick="role_post_desc()"
              >
                Innovator
              </h1>
            </div>
            <div class="column">
              <h1
                id="sty_choice_role"
                class="sty-subtitle-low-font-size sty-font-family-roboto sty-role"
                onclick="role_post_desc()"
              >
                Collector
              </h1>
            </div>
          </div>
          -->
          <!-- Hidden Role-->
          <input
            type="text"
            id="inp_role"
            value="{{ post_data.user_role_type }}"
            hidden
          />
          <div class="columns is-vcentered">
            <div class="column is-2">
              <h1 class="sty-icon-info">
                <ion-icon name="information-circle"></ion-icon>
              </h1>
            </div>
            <div class="column">
              <h1
                id="desc_onchange"
                class="sty-subtitle-lower-font-size sty-font-family-hind sty-description-lbl"
              >
                description
              </h1>
            </div>
          </div>
        </div>
        <div class="column">
          <div class="columns is-vcentered">
            <div class="column is-2">
              <ion-icon name="person-circle"></ion-icon>
            </div>
            <div class="column has-text-left sty-mdl-msg">
              <h1 style="font-weight: 700">{{ post_data.USER_ID.username }}</h1>
              <h1>{{ post_data.modified_at }}</h1>
              <h1>
                <ion-icon name="location"></ion-icon>
                <!-- prettier-ignore- -->
                {{ post_data.USER_ID.city_or_municipality }}
                <!-- prettier-ignore -->
              </h1>
            </div>
          </div>
          <div
            class="sty-inp-postAdd-image sty-inp-IN-image"
            id="btn_inp_image"
          >
            <!-- CSS ISSUE -->
            <h1>
              <ion-icon name="add-circle" style="font-size: 195px"></ion-icon>
            </h1>
            <!-- HIDDEN INPUT FILE -->
            <input
              type="file"
              src=""
              name=""
              id="inp_image"
              accept="image/*"
              hidden
              multiple
            />
          </div>
        </div>
      </div>
      <div class="has-text-centered sty-err-msg" id="err_msg"></div>
    </div>
    {% endif %}
    <!-- prettier-ignore -->

    {% for data in post_data_blob %}
    <img
      data-url="{{ data.blob.url }}"
      src="{{ data.blob.url }}"
      alt="Image Blob"
      class="preview-img"
      hidden
    />

    {% endfor %}
    <div id="get_link" data-url="{% url 'main:diyconn_home' %}" hidden></div>
    {% endblock content %}
    <!-- //prettier-ignore -->

    <script>
      //{% block scripts %}
      // GIVEN
      let usr_all_bck_opt_ref = document.getElementById("usr_all_bck_opt_ref");
      let get_link = document.getElementById("get_link");
      usr_all_bck_opt_label.textContent = "Retrieve Post";
      usr_all_bck_opt_ref.href = get_link.getAttribute("data-url");

      function role_initialized() {
        let i = 0;
        let ini_inp_role = document.getElementById("inp_role");
        let ini_desc_onchange = document.getElementById("desc_onchange");
        let role_desc = ini_inp_role.value;
        let sty_choice_role = document.querySelectorAll("#sty_choice_role");
        /*
        sty_choice_role.forEach((el) =>
          el.classList.add("sty-role-not-selected")
        );
        */

        if (role_desc === "Contributor") {
          desc_onchange.innerHTML =
            "A Contributor is an individual who provides materials, resources, or support to a project, organization, or business. <b> As a contributor, you are encouraged to share items that can be repurposed, ensuring they are useful to others. Please only post items that you are willing to give away freely for the benefit of those who can make use of them. </b>";
          inp_role.value = "Contributor";
          i = 0;
        } else if (role_desc === "Innovator") {
          desc_onchange.innerHTML =
            "An Innovator is an  individual who  collects and creatively repurposes items to give them a second life through innovative projects. <b> As an innovator, you should only post projects that you genuinely intend to create</b>, demonstrating how the collected items can be transformed into something new and valuable. By doing so, you contribute to a more sustainable and environmentally friendly community.";
          inp_role.value = "Innovator";
          i = 1;
        } else if (role_desc === "Collector") {
          desc_onchange.innerHTML =
            "A Collector is an individual who gathers recyclable items that can be exchanged for money or other benefits. If you are a collector, you should only <b> post items that you are actively looking to collect and are willing to pick up or receive.</b> This helps facilitate an efficient exchange process while promoting recycling and sustainability.";
          inp_role.value = "Collector";
          i = 2;
        } /*
        sty_choice_role[i].classList.remove("sty-role-not-selected");
        sty_choice_role[i].classList.add("sty-role-selected");
        */
      }
      role_initialized();

      function blob_ini() {
        const btn_inp_image = document.getElementById("btn_inp_image");
        const err_msg = document.getElementById("err_msg"); // Optional: if you show errors
        const imageElements = document.querySelectorAll(".preview-img");

        const count = imageElements.length;

        // Setup grid layout
        if (count === 1) {
          btn_inp_image.style.gridTemplateColumns = "1fr";
          btn_inp_image.style.gridTemplateRows = "1fr";
        } else if (count === 2) {
          btn_inp_image.style.gridTemplateColumns = "1fr 1fr";
          btn_inp_image.style.gridTemplateRows = "1fr";
        } else if (count === 3 || count === 4) {
          btn_inp_image.style.gridTemplateColumns = "1fr 1fr";
          btn_inp_image.style.gridTemplateRows = "1fr 1fr";
        } else {
          if (err_msg) err_msg.textContent = "Can only take 4 images per post";
          return;
        }

        // Clear container and display as grid
        btn_inp_image.innerHTML = "";
        btn_inp_image.style.display = "grid";

        // Add each image dynamically
        imageElements.forEach((imgEl, index) => {
          const imageUrl = imgEl.dataset.url;

          const img = document.createElement("img");
          img.src = imageUrl;
          img.style.width = "100%";
          img.style.height = "100%";
          img.style.objectFit = "cover";

          if (count === 3 && index === 2) {
            img.style.gridColumn = "1 / span 2";
          }

          btn_inp_image.appendChild(img);
        });

        // Hide inner h1 if exists (optional)
        const textElement = btn_inp_image.querySelector("h1");
        if (textElement) textElement.style.display = "none";
      }

      document.addEventListener("DOMContentLoaded", blob_ini);

      function copyLinkPost(event) {
        const target = event.currentTarget; // More reliable than event.target
        const url = target.getAttribute("data-url");
        const fullUrl = `${window.location.origin}${url}`;

        // Copy to clipboard
        navigator.clipboard
          .writeText(fullUrl)
          .then(() => {
            console.log("Copied to clipboard:", fullUrl);
            alert("Link copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy:", err);
          });
      }
      //{% endblock scripts %}
    </script>
  </body>
</html>
